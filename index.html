<!doctype>
<html>
    <head>
        <script type="text/javascript" src="web3.js"></script>
        <script type="text/javascript">
            function log(message) {
                var
                        node = document.createElement("LI"),
                        textnode = document.createTextNode(message),
                        log = document.getElementById("log");

                node.appendChild(textnode);
                log.insertBefore(node, log.firstChild);
            }

            var Web3 = require('web3');
            var web3 = new Web3();
            web3.setProvider(new web3.providers.HttpProvider('http://localhost:8000'));
            web3.eth.defaultAccount = "0x6d4bdb8f2c9ed3caac4ce6e57bc8fa8ecfcc8251";

            var EthereumTraining;

            var ethereumtrainingContract = web3.eth.contract([{"constant": false, "inputs": [{"name": "name", "type": "string"}, {"name": "age", "type": "uint8"}, {"name": "specialty", "type": "string"}, {"name": "twitter_url", "type": "string"}, {"name": "github_url", "type": "string"}, {"name": "linkedin_url", "type": "string"}], "name": "createProfile", "outputs": [{"name": "profile_id", "type": "uint256"}], "type": "function"}, {"constant": false, "inputs": [], "name": "next", "outputs": [{"name": "name", "type": "string"}, {"name": "age", "type": "uint8"}, {"name": "specialty", "type": "string"}, {"name": "twitter_url", "type": "string"}, {"name": "github_url", "type": "string"}, {"name": "linkedin_url", "type": "string"}], "type": "function"}, {"constant": true, "inputs": [], "name": "canIModifyProfiles", "outputs": [{"name": "", "type": "bool"}], "type": "function"}, {"constant": false, "inputs": [{"name": "profile_id", "type": "uint256"}, {"name": "name", "type": "string"}, {"name": "age", "type": "uint8"}, {"name": "specialty", "type": "string"}, {"name": "twitter_url", "type": "string"}, {"name": "github_url", "type": "string"}, {"name": "linkedin_url", "type": "string"}], "name": "updateProfile", "outputs": [{"name": "", "type": "bool"}], "type": "function"}, {"constant": true, "inputs": [], "name": "hasNext", "outputs": [{"name": "", "type": "bool"}], "type": "function"}, {"constant": false, "inputs": [], "name": "rewind", "outputs": [], "type": "function"}, {"constant": true, "inputs": [{"name": "profile_id", "type": "uint256"}], "name": "getProfile", "outputs": [{"name": "name", "type": "string"}, {"name": "age", "type": "uint8"}, {"name": "specialty", "type": "string"}, {"name": "twitter_url", "type": "string"}, {"name": "github_url", "type": "string"}, {"name": "linkedin_url", "type": "string"}], "type": "function"}, {"inputs": [], "type": "constructor"}, {"anonymous": false, "inputs": [{"indexed": false, "name": "profile_id", "type": "uint256"}], "name": "profileCreated", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": false, "name": "profile_id", "type": "uint256"}], "name": "profileUpdated", "type": "event"}]);

            function contract_install() {
                ethereumtrainingContract.new(
                        {
                            from: web3.eth.accounts[0],
                            data: '60606040525b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b611e608061003f6000396000f36060604052361561007f576000357c0100000000000000000000000000000000000000000000000000000000900480634148205f1461008c5780634c8fe5261461021b578063aa1df1281461041c578063ca30787b1461043f578063df4a2ecc146105d7578063e124e95b146105fa578063f08f4f64146106095761007f565b61008a5b610002565b565b005b6102056004808035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091905050610813565b6040518082815260200191505060405180910390f35b61022860048050506119be565b60405180806020018760ff1681526020018060200180602001806020018060200186810386528c8181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156102a15780820380516001836020036101000a031916815260200191505b5086810385528a8181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156102fa5780820380516001836020036101000a031916815260200191505b508681038452898181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156103535780820380516001836020036101000a031916815260200191505b508681038352888181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156103ac5780820380516001836020036101000a031916815260200191505b508681038252878181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156104055780820380516001836020036101000a031916815260200191505b509b50505050505050505050505060405180910390f35b610429600480505061191b565b6040518082815260200191505060405180910390f35b6105c16004808035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050909091908035906020019082018035906020019191908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509090919050506113b8565b6040518082815260200191505060405180910390f35b6105e46004805050611978565b6040518082815260200191505060405180910390f35b6106076004805050611e28565b005b61061f6004808035906020019091905050610f8e565b60405180806020018760ff1681526020018060200180602001806020018060200186810386528c8181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156106985780820380516001836020036101000a031916815260200191505b5086810385528a8181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156106f15780820380516001836020036101000a031916815260200191505b508681038452898181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561074a5780820380516001836020036101000a031916815260200191505b508681038352888181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156107a35780820380516001836020036101000a031916815260200191505b508681038252878181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156107fc5780820380516001836020036101000a031916815260200191505b509b50505050505050505050505060405180910390f35b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561087157610002565b868686600083511480610887575060008260ff16145b80610893575060008151145b1561089d57610002565b60016000508054806001018281815481835581811511610b2857600602816006028360005260206000209182019101610b2791906108d6565b80821115610b235760006000820160006101000a81549060ff02191690556000820160016101000a81549060ff021916905560018201600050805460018160011615610100020316600290046000825580601f106109345750610971565b601f0160209004906000526020600020908101906109709190610952565b8082111561096c5760008181506000905550600101610952565b5090565b5b5060028201600050805460018160011615610100020316600290046000825580601f1061099e57506109db565b601f0160209004906000526020600020908101906109da91906109bc565b808211156109d657600081815060009055506001016109bc565b5090565b5b5060038201600050805460018160011615610100020316600290046000825580601f10610a085750610a45565b601f016020900490600052602060002090810190610a449190610a26565b80821115610a405760008181506000905550600101610a26565b5090565b5b5060048201600050805460018160011615610100020316600290046000825580601f10610a725750610aaf565b601f016020900490600052602060002090810190610aae9190610a90565b80821115610aaa5760008181506000905550600101610a90565b5090565b5b5060058201600050805460018160011615610100020316600290046000825580601f10610adc5750610b19565b601f016020900490600052602060002090810190610b189190610afa565b80821115610b145760008181506000905550600101610afa565b5090565b5b50506001016108d6565b5090565b5b5050509190906000526020600020906006020160005b60e060405190810160405280600181526020018d81526020018e81526020018c81526020018b81526020018a815260200189815260200150909190915060008201518160000160006101000a81548160ff0219169083021790555060208201518160000160016101000a81548160ff021916908302179055506040820151816001016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610c0c57805160ff1916838001178555610c3d565b82800160010185558215610c3d579182015b82811115610c3c578251826000505591602001919060010190610c1e565b5b509050610c689190610c4a565b80821115610c645760008181506000905550600101610c4a565b5090565b50506060820151816002016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610cbf57805160ff1916838001178555610cf0565b82800160010185558215610cf0579182015b82811115610cef578251826000505591602001919060010190610cd1565b5b509050610d1b9190610cfd565b80821115610d175760008181506000905550600101610cfd565b5090565b50506080820151816003016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610d7257805160ff1916838001178555610da3565b82800160010185558215610da3579182015b82811115610da2578251826000505591602001919060010190610d84565b5b509050610dce9190610db0565b80821115610dca5760008181506000905550600101610db0565b5090565b505060a0820151816004016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610e2557805160ff1916838001178555610e56565b82800160010185558215610e56579182015b82811115610e55578251826000505591602001919060010190610e37565b5b509050610e819190610e63565b80821115610e7d5760008181506000905550600101610e63565b5090565b505060c0820151816005016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610ed857805160ff1916838001178555610f09565b82800160010185558215610f09579182015b82811115610f08578251826000505591602001919060010190610eea565b5b509050610f349190610f16565b80821115610f305760008181506000905550600101610f16565b5090565b5050505050600160016000508054905003935083507fc57527566da8300b8c4fce5e0ac456766447628303ae8b728c0b234320cbb409846040518082815260200191505060405180910390a15050505b9695505050505050565b6020604051908101604052806000815260200150600060206040519081016040528060008152602001506020604051908101604052806000815260200150602060405190810160405280600081526020015060206040519081016040528060008152602001506000876001600160005082815481101561000257906000526020600020906006020160005b5060000160009054906101000a900460ff1614151561103757610002565b600160005089815481101561000257906000526020600020906006020160005b509150816001016000508260000160019054906101000a900460ff1683600201600050846003016000508560040160005086600501600050858054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156111245780601f106110f957610100808354040283529160200191611124565b820191906000526020600020905b81548152906001019060200180831161110757829003601f168201915b50505050509550838054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156111c05780601f10611195576101008083540402835291602001916111c0565b820191906000526020600020905b8154815290600101906020018083116111a357829003601f168201915b50505050509350828054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561125c5780601f106112315761010080835404028352916020019161125c565b820191906000526020600020905b81548152906001019060200180831161123f57829003601f168201915b50505050509250818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156112f85780601f106112cd576101008083540402835291602001916112f8565b820191906000526020600020905b8154815290600101906020018083116112db57829003601f168201915b50505050509150808054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113945780601f1061136957610100808354040283529160200191611394565b820191906000526020600020905b81548152906001019060200180831161137757829003601f168201915b50505050509050975097509750975097509750506113ae56505b5091939550919395565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561141657610002565b876001600160005082815481101561000257906000526020600020906006020160005b5060000160009054906101000a900460ff1614151561145757610002565b87878760008351148061146d575060008260ff16145b80611479575060008151145b1561148357610002565b8960016000508d815481101561000257906000526020600020906006020160005b5060000160016101000a81548160ff021916908302179055508a60016000508d815481101561000257906000526020600020906006020160005b506001016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061152e57805160ff191683800117855561155f565b8280016001018555821561155f579182015b8281111561155e578251826000505591602001919060010190611540565b5b50905061158a919061156c565b80821115611586576000818150600090555060010161156c565b5090565b50508860016000508d815481101561000257906000526020600020906006020160005b506002016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106115fd57805160ff191683800117855561162e565b8280016001018555821561162e579182015b8281111561162d57825182600050559160200191906001019061160f565b5b509050611659919061163b565b80821115611655576000818150600090555060010161163b565b5090565b50508760016000508d815481101561000257906000526020600020906006020160005b506003016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106116cc57805160ff19168380011785556116fd565b828001600101855582156116fd579182015b828111156116fc5782518260005055916020019190600101906116de565b5b509050611728919061170a565b80821115611724576000818150600090555060010161170a565b5090565b50508660016000508d815481101561000257906000526020600020906006020160005b506004016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061179b57805160ff19168380011785556117cc565b828001600101855582156117cc579182015b828111156117cb5782518260005055916020019190600101906117ad565b5b5090506117f791906117d9565b808211156117f357600081815060009055506001016117d9565b5090565b50508560016000508d815481101561000257906000526020600020906006020160005b506005016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061186a57805160ff191683800117855561189b565b8280016001018555821561189b579182015b8281111561189a57825182600050559160200191906001019061187c565b5b5090506118c691906118a8565b808211156118c257600081815060009055506001016118a8565b5090565b50507f59aa127af02c5b9ba4a21073a885c98e74e478ef10c94b61a6c93ba6b3ebb9248c6040518082815260200191505060405180910390a1600194505050505061191056505050505b979650505050505050565b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16149050611975565b90565b6000600160005080549050600260005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050541090506119bb565b90565b6020604051908101604052806000815260200150600060206040519081016040528060008152602001506020604051908101604052806000815260200150602060405190810160405280600081526020015060206040519081016040528060008152602001506000611a2e611978565b15611e19576001600050600260005060003373ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060005054815481101561000257906000526020600020906006020160005b509050600260005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081815054809291906001019190505550806001016000508160000160019054906101000a900460ff1682600201600050836003016000508460040160005085600501600050858054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611b8d5780601f10611b6257610100808354040283529160200191611b8d565b820191906000526020600020905b815481529060010190602001808311611b7057829003601f168201915b50505050509550838054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611c295780601f10611bfe57610100808354040283529160200191611c29565b820191906000526020600020905b815481529060010190602001808311611c0c57829003601f168201915b50505050509350828054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611cc55780601f10611c9a57610100808354040283529160200191611cc5565b820191906000526020600020905b815481529060010190602001808311611ca857829003601f168201915b50505050509250818054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611d615780601f10611d3657610100808354040283529160200191611d61565b820191906000526020600020905b815481529060010190602001808311611d4457829003601f168201915b50505050509150808054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611dfd5780601f10611dd257610100808354040283529160200191611dfd565b820191906000526020600020905b815481529060010190602001808311611de057829003601f168201915b50505050509050965096509650965096509650611e1f56611e1e565b610002565b5b50909192939495565b6000600260005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050819055505b56',
                            gas: 3000000
                        }, function(e, contract) {
                    console.log(e, contract);
                    if (typeof contract.address != 'undefined') {
                        log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);

                        EthereumTraining = ethereumtrainingContract.at(contract.address);

                        var events = EthereumTraining.allEvents({fromBlock: 0, toBlock: 'latest'});

                        events.watch(events_handler);
                    }
                });
            }

            function contract_init(address) {
                EthereumTraining = ethereumtrainingContract.at(address);

                var events = EthereumTraining.allEvents({fromBlock: 0, toBlock: 'latest'});

                events.watch(events_handler);
            }

            function events_handler(error, result) {
                if (error) {
                    log(error);
                }
                else {
                    log('Event triggered: ' + result.event + '; Profile ID: ' + result.args.profile_id);

                    document.getElementById('profile_update_id').value = result.args.profile_id
                }

                console.log(error, result);
            }

            function createProfile() {
                var result = EthereumTraining.createProfile(
                        document.getElementById('name').value,
                        document.getElementById('age').value,
                        document.getElementById('specialty').value,
                        document.getElementById('twitter_url').value,
                        document.getElementById('github_url').value,
                        document.getElementById('linkedin_url').value,
                        {gas: 3000000});

                log('Transaction createProfile: ' + result);
            }

            function updateProfile() {
                var result = EthereumTraining.updateProfile(
                        document.getElementById('profile_update_id').value,
                        document.getElementById('name').value,
                        document.getElementById('age').value,
                        document.getElementById('specialty').value,
                        document.getElementById('twitter_url').value,
                        document.getElementById('github_url').value,
                        document.getElementById('linkedin_url').value,
                        {gas: 3000000});

                log('Transaction updateProfile: ' + result);
            }

            function getProfile() {
                var profile = EthereumTraining.getProfile.call(document.getElementById('profile_get_id').value);

                log('Called getProfile(' + document.getElementById('profile_get_id').value + '); result: ' + profile.toString());
                console.log(profile);
                document.getElementById('profile_update_id').value = document.getElementById('profile_get_id').value;
                document.getElementById('name').value = profile[0];
                document.getElementById('age').value = profile[1];
                document.getElementById('specialty').value = profile[2];
                document.getElementById('twitter_url').value = profile[3];
                document.getElementById('github_url').value = profile[4];
                document.getElementById('linkedin_url').value = profile[5];
            }
        </script>
    </head>

    <body>
        <ul id='log'></ul>
        <table border='0'>
            <tr>
                <td><button type="button" onclick="contract_install()">Install</button></td>
                <td></td>
            </tr>
            <tr>
                <td><button type="button" onclick="contract_init(document.getElementById('contract_address').value)">Init Existing</button></td>
                <td><input type="text" id='contract_address' value="contract address" /></td>
            </tr>
            <tr>
                <td></td>
                <td><button onclick="createProfile();">createProfile</button></td>
            </tr>
            <tr>
                <td><button onclick="updateProfile();">updateProfile</button></td>
                <td><input id='profile_update_id' type='text' /></td>
            </tr>
            <tr>
                <td><button onclick="getProfile();">getProfile</button></td>
                <td><input id='profile_get_id' type='text' /></td>
            </tr>
            <tr>
                <td>Name</td>
                <td><input id="name" type='text' value='Zvezdomir Zlatinov' /></td>
            </tr>
            <tr>
                <td>Age</td>
                <td><input id="age" type='text' value='27' /></td>
            </tr>
            <tr>
                <td>Specialty</td>
                <td><input id="specialty" type='text' value='Blockchain Dev' /></td>
            </tr>
            <tr>
                <td>Twitter</td>
                <td><input id="twitter_url" type='text' value='' /></td>
            </tr>
            <tr>
                <td>GitHub</td>
                <td><input id="github_url" type='text' value='' /></td>
            </tr>
            <tr>
                <td>LinkedIn</td>
                <td><input id="linkedin_url" type='text' value='' /></td>
            </tr>
        </table>
    </body>
</html>
